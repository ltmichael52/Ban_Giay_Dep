USE [ShoesStore];

CREATE TABLE TAIKHOAN(
	EMAIL NVARCHAR(255) PRIMARY KEY NOT NULL,
	MATKHAU NVARCHAR(255) NOT NULL,
	LOAITK INT NOT NULL
);

Create table KHACHHANG(
	IDKH INT Primary Key Identity(1,1) NOT NULL,
	TENKH NVARCHAR(255) NOT NULL,
	EMAIL NVARCHAR(255) NOT NULL,
	DIACHI NVARCHAR(255) NOT NULL,
	SDT NVARCHAR(255) NOT NULL,
	GIOITINH bit NULL,
	NGAYSINH DATETIME,
	FOREIGN KEY(EMAIL) REFERENCES TAIKHOAN(EMAIL)
);

Create table NHANVIEN(
	IDNV INT Primary Key Identity(1,1) NOT NULL,
	TENNV NVARCHAR(255) NOT NULL,
	EMAIL NVARCHAR(255) NOT NULL,
	DIACHI NVARCHAR(255) NOT NULL,
	SDT NVARCHAR(255) NOT NULL,
	GIOITINH bit NOT NULL,
	NGAYSINH DATETIME,
	FOREIGN KEY(EMAIL) REFERENCES TAIKHOAN(EMAIL)
);

CREATE TABLE LOAI(
	IDLOAI INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	TENLOAI NVARCHAR(255) UNIQUE NOT NULL,
);

CREATE TABLE SANPHAM(
	IDSP INT PRIMARY KEY,
	IDLOAI INT NOT NULL,
	TENSP NVARCHAR(255) NOT NULL,
	GIAGOC decimal(18, 2) NOT NULL,
	PHANTRAMGIAM int,
	DETAIL NVARCHAR(MAX) NOT NULL,
	HIENTHI bit ,
	MOI bit,
	HOT bit,
	FOREIGN KEY(IDLOAI) REFERENCES LOAI(IDLOAI)
);

CREATE TABLE MAU(
	IDMAU INT PRIMARY KEY IDENTITY(1,1),
	TENMAU NVARCHAR(255)
);

CREATE TABLE SIZE(
	IDSIZE INT PRIMARY KEY IDENTITY(1,1),
	TENSIZE NVARCHAR(255)
);

CREATE TABLE CHITIETSANPHAM(
	IDCHITIETSP INT PRIMARY KEY IDENTITY(1,1),
	IDSP INT NOT NULL,
	IDMAU INT NOT NULL,
	ANHDAIDIEN NVARCHAR(255),
	FOREIGN KEY(IDSP) REFERENCES SANPHAM(IDSP),
	FOREIGN KEY(IDMAU) REFERENCES MAU(IDMAU),
);

CREATE TABLE TONKHO(
	IDCHITIETSP INT NOT NULL,
	IDSIZE INT NOT NULL,
	SLTON INT  NOT NULL,
	FOREIGN KEY(IDCHITIETSP) REFERENCES CHITIETSANPHAM(IDCHITIETSP),
	FOREIGN KEY(IDSIZE) REFERENCES SIZE(IDSIZE),
	PRIMARY KEY(IDCHITIETSP,IDSIZE)
);

CREATE TABLE ANHCHITIETSP(
	IDCHITIETSP INT NOT NULL,
	TENANH NVARCHAR(255) NOT NULL,
	VITRI NVARCHAR(MAX),

	FOREIGN KEY(IDCHITIETSP) REFERENCES CHITIETSANPHAM(IDCHITIETSP),
	PRIMARY KEY(IDCHITIETSP,TENANH)
);

CREATE TABLE PHIEUDAT(
	IDPD INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	NGAYDAT DATETIME NOT NULL,
	IDKH INT NOT NULL,
	IDNV INT,
	TINHTRANG NVARCHAR(255) NOT NULL,
	PHUONGTHUCTHANHTOAN NVARCHAR(255) NOT NULL,
	GHICHU NVARCHAR(MAX),
	LYDOHUYDON NVARCHAR(255),
	FOREIGN KEY(IDKH) REFERENCES KHACHHANG(IDKH),
	FOREIGN KEY(IDNV) REFERENCES NHANVIEN(IDNV)
);


CREATE TABLE CHITIETPHIEUDAT(
	IDPD INT NOT NULL,
	IDCHITIETSP INT NOT NULL,
	TONGTIEN decimal(18, 2) NOT NULL,
	SOLUONG INT,
	FOREIGN KEY(IDPD) REFERENCES PHIEUDAT(IDPD),
	FOREIGN KEY(IDCHITIETSP) REFERENCES CHITIETSANPHAM(IDCHITIETSP),
	PRIMARY KEY(IDPD,IDCHITIETSP)
);

CREATE TABLE __EFMIGRATIONSHISTORY(
	MIGRATIONID NVARCHAR(255) NOT NULL,
	PRODUCTVERSION NVARCHAR(255) NOT NULL
);

INSERT INTO __EFMIGRATIONSHISTORY(MIGRATIONID,PRODUCTVERSION) VALUES ('20240223021636_v0','7.0.16');
